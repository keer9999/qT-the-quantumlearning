<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Bloch Sphere – Complete Guide | The Quanta</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="global-ui.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap"
    rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        tags: 'none'
      },
      svg: { fontCache: 'global' },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea'] }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>

  <style>
    :root {
      --navy: #03122e;
      --blue: #0057b8;
      --sky: #00b4d8;
      --light: #f0f6ff;
      --fg: #1e293b;
      --muted: #64748b;
      --border: #e2e8f0;
      --card-shadow: 0 8px 32px rgba(0, 40, 120, .10);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #f4f7fc;
      color: var(--fg);
      min-height: 100vh;
    }

    /* ── HERO ── */
    .bs-hero {
      background: linear-gradient(135deg, #03122e 0%, #0a2554 60%, #0057b8 100%);
      padding: 56px 32px 48px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .bs-hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' stroke='rgba(255,255,255,.04)' stroke-width='1'%3E%3Ccircle cx='30' cy='30' r='28'/%3E%3Ccircle cx='30' cy='30' r='20'/%3E%3Ccircle cx='30' cy='30' r='12'/%3E%3C/g%3E%3C/svg%3E") repeat;
      pointer-events: none;
    }

    .bs-hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, .10);
      border: 1px solid rgba(255, 255, 255, .18);
      border-radius: 100px;
      padding: 6px 16px;
      font-size: 12px;
      font-weight: 600;
      color: #a5c8ff;
      letter-spacing: .1em;
      text-transform: uppercase;
      margin-bottom: 20px;
    }

    .bs-hero h1 {
      font-size: clamp(28px, 5vw, 52px);
      font-weight: 800;
      color: #fff;
      margin-bottom: 14px;
      letter-spacing: -.02em;
    }

    .bs-hero p {
      font-size: 17px;
      color: #a5c8ff;
      max-width: 600px;
      margin: 0 auto 30px;
      line-height: 1.7;
    }

    .bs-hero-chips {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .bs-chip {
      background: rgba(255, 255, 255, .08);
      border: 1px solid rgba(255, 255, 255, .14);
      color: #c7defc;
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
    }

    /* ── LAYOUT ── */
    .bs-wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    .bs-section {
      background: #fff;
      border-radius: 20px;
      box-shadow: var(--card-shadow);
      padding: 36px 40px;
      margin-bottom: 32px;
    }

    .bs-section-hd {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 24px;
    }

    .bs-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .bs-icon.blue {
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    }

    .bs-icon.green {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    }

    .bs-icon.purple {
      background: linear-gradient(135deg, #ede9fe, #ddd6fe);
    }

    .bs-icon.amber {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
    }

    .bs-icon.rose {
      background: linear-gradient(135deg, #fee2e2, #fecaca);
    }

    .bs-section-hd h2 {
      font-size: 22px;
      font-weight: 700;
      color: var(--navy);
    }

    .bs-section-hd p {
      font-size: 13px;
      color: var(--muted);
      margin-top: 2px;
    }

    /* ── SVG ICON DEFINITIONS ── */

    /* ── PROSE ── */
    .bs-prose {
      font-size: 15px;
      color: #334155;
      line-height: 1.8;
    }

    .bs-prose p {
      margin-bottom: 14px;
    }

    .bs-prose strong {
      color: var(--navy);
    }

    /* ── FORMULA CARDS ── */
    .bs-formula-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }

    .bs-formula-card {
      background: var(--navy);
      border-radius: 14px;
      padding: 20px 22px;
      color: #e2e8f0;
    }

    .bs-formula-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .14em;
      color: #38bdf8;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .bs-formula-math {
      font-family: 'JetBrains Mono', monospace;
      font-size: 16px;
      color: #f1f5f9;
      margin-bottom: 6px;
    }

    .bs-formula-desc {
      font-size: 12px;
      color: #94a3b8;
      line-height: 1.5;
    }

    /* ── STATE TABLE ── */
    .bs-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    .bs-table th {
      background: var(--navy);
      color: #fff;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .08em;
      text-transform: uppercase;
      padding: 12px 16px;
      text-align: left;
    }

    .bs-table th:first-child {
      border-radius: 10px 0 0 0;
    }

    .bs-table th:last-child {
      border-radius: 0 10px 0 0;
    }

    .bs-table td {
      padding: 12px 16px;
      font-size: 14px;
      border-bottom: 1px solid var(--border);
    }

    .bs-table tr:hover td {
      background: var(--light);
    }

    .bs-table .tag {
      display: inline-block;
      background: var(--light);
      border: 1px solid #c7deff;
      border-radius: 6px;
      padding: 2px 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      color: var(--blue);
    }

    /* ── 3D SIMULATOR ── */
    .bs-sim-wrap {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 28px;
      align-items: start;
    }

    @media(max-width:900px) {
      .bs-sim-wrap {
        grid-template-columns: 1fr;
      }
    }

    #blochCanvas {
      width: 380px;
      height: 380px;
      border-radius: 16px;
      background: radial-gradient(circle at 40% 35%, #0d1b3e, #00091f);
      display: block;
      cursor: grab;
    }

    #blochCanvas:active {
      cursor: grabbing;
    }

    .bs-controls {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .bs-ctrl-group {
      background: var(--light);
      border-radius: 14px;
      padding: 18px;
    }

    .bs-ctrl-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .12em;
      color: var(--blue);
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .bs-range-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .bs-range-row label {
      font-size: 13px;
      font-weight: 600;
      color: var(--navy);
      min-width: 120px;
    }

    .bs-range-row input[type=range] {
      flex: 1;
      accent-color: var(--blue);
    }

    .bs-range-row span {
      font-size: 12px;
      font-family: 'JetBrains Mono', monospace;
      color: var(--blue);
      min-width: 44px;
      text-align: right;
    }

    .bs-state-pill {
      background: #fff;
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: var(--navy);
      line-height: 1.7;
    }

    .bs-state-pill .highlight {
      color: var(--blue);
      font-weight: 700;
    }

    .bs-gate-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .bs-gate-btn {
      padding: 7px 14px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 13px;
      font-weight: 700;
      background: #fff;
      color: var(--fg);
      cursor: pointer;
      transition: all .18s;
      font-family: 'JetBrains Mono', monospace;
    }

    .bs-gate-btn:hover {
      border-color: var(--blue);
      color: var(--blue);
      background: var(--light);
    }

    .bs-measure-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, var(--blue), var(--sky));
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all .2s;
      letter-spacing: .02em;
    }

    .bs-measure-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 87, 184, .4);
    }

    .bs-prob-bar-wrap {
      margin-top: 10px;
    }

    .bs-prob-bar-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .bs-prob-bar-row span:first-child {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      font-weight: 700;
      color: var(--navy);
      min-width: 30px;
    }

    .bs-prob-track {
      flex: 1;
      height: 10px;
      background: #e2e8f0;
      border-radius: 6px;
      overflow: hidden;
    }

    .bs-prob-fill {
      height: 100%;
      border-radius: 6px;
      transition: width .3s ease;
    }

    .bs-prob-fill.f0 {
      background: linear-gradient(90deg, #0057b8, #00b4d8);
    }

    .bs-prob-fill.f1 {
      background: linear-gradient(90deg, #7c3aed, #c026d3);
    }

    .bs-prob-val {
      font-size: 12px;
      font-family: 'JetBrains Mono', monospace;
      color: var(--muted);
      min-width: 38px;
      text-align: right;
    }

    /* ── COORDINATE BREAKDOWN ── */
    .bs-coord-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin: 20px 0;
    }

    .bs-coord-card {
      border-radius: 14px;
      padding: 20px;
      border: 2px solid var(--border);
      text-align: center;
    }

    .bs-coord-card.x {
      border-color: #fca5a5;
      background: #fff1f2;
    }

    .bs-coord-card.y {
      border-color: #fdba74;
      background: #fff7ed;
    }

    .bs-coord-card.z {
      border-color: #86efac;
      background: #f0fdf4;
    }

    .bs-coord-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .1em;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .bs-coord-card.x .bs-coord-label {
      color: #dc2626;
    }

    .bs-coord-card.y .bs-coord-label {
      color: #ea580c;
    }

    .bs-coord-card.z .bs-coord-label {
      color: #16a34a;
    }

    .bs-coord-formula {
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      font-weight: 700;
      color: var(--navy);
      margin-bottom: 6px;
    }

    .bs-coord-desc {
      font-size: 12px;
      color: var(--muted);
    }

    /* ── GATE TABLE ── */
    .bs-gate-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 14px;
      margin-top: 16px;
    }

    .bs-gate-card {
      border-radius: 14px;
      padding: 18px 20px;
      border: 1.5px solid var(--border);
    }

    .bs-gate-card-name {
      font-size: 20px;
      font-weight: 800;
      color: var(--navy);
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 4px;
    }

    .bs-gate-card-sub {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: .1em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    .bs-gate-card-action {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: var(--blue);
      background: var(--light);
      border-radius: 6px;
      padding: 6px 10px;
      margin-bottom: 8px;
    }

    .bs-gate-card-desc {
      font-size: 13px;
      color: #475569;
      line-height: 1.6;
    }

    /* ── DENSITY MATRIX ── */
    .bs-dm-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 16px;
    }

    .bs-dm-card {
      background: var(--navy);
      border-radius: 14px;
      padding: 22px;
    }

    .bs-dm-title {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: .12em;
      color: #38bdf8;
      text-transform: uppercase;
      margin-bottom: 14px;
    }

    .bs-dm-math {
      font-size: 15px;
      color: #f1f5f9;
      line-height: 2.2;
    }

    .bs-dm-math .MJX-TEX {
      color: #f1f5f9;
    }

    .bs-dm-note {
      font-size: 12px;
      color: #94a3b8;
      margin-top: 10px;
      line-height: 1.5;
    }

    /* ── HISTORY CALLOUT ── */
    .bs-history {
      background: linear-gradient(135deg, #1e1b4b, #1e3a8a);
      border-radius: 16px;
      padding: 28px 32px;
      display: grid;
      grid-template-columns: 72px 1fr;
      gap: 24px;
      align-items: center;
      margin-top: 16px;
    }

    .bs-history-icon-wrap {
      width: 72px;
      height: 72px;
      border-radius: 14px;
      background: rgba(255, 255, 255, .1);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .bs-history-text h3 {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }

    .bs-history-text p {
      font-size: 14px;
      color: #c7d8fc;
      line-height: 1.7;
    }

    /* ── MISC ── */
    .bs-divider {
      height: 1px;
      background: var(--border);
      margin: 24px 0;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg)
      }

      to {
        transform: rotate(360deg)
      }
    }

    canvas {
      display: block;
    }

    #fw {
      position: fixed;
      inset: 0;
      pointer-events: none;
      display: none;
    }
  </style>
</head>

<body>
  <div class="global-back-btn" onclick="goBackGlobal()" title="Go Back">&#8592;</div>

  <!-- HERO -->
  <div class="bs-hero">
    <div class="bs-hero-badge">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#a5c8ff" stroke-width="2.5">
        <circle cx="12" cy="12" r="10" />
        <path d="M12 2v20M2 12h20" />
      </svg>
      Quantum Mechanics — Visual Guide
    </div>
    <h1>The Bloch Sphere</h1>
    <p>A complete mathematical and geometric treatment of the qubit state space — from first principles to quantum
      gates.</p>
    <div class="bs-hero-chips">
      <span class="bs-chip">Pure State Geometry</span>
      <span class="bs-chip">Quantum Gate Rotations</span>
      <span class="bs-chip">Density Matrix</span>
      <span class="bs-chip">Decoherence</span>
      <span class="bs-chip">Interactive 3D Simulator</span>
    </div>

    <!-- ✨ SHINING DIAGRAM CTA ✨ -->
    <style>
      @keyframes bs-shimmer {
        0% {
          background-position: -300% center
        }

        100% {
          background-position: 300% center
        }
      }

      @keyframes bs-glow {

        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(0, 212, 255, .6), 0 10px 40px rgba(0, 87, 184, .55)
        }

        50% {
          box-shadow: 0 0 0 12px rgba(0, 212, 255, 0), 0 14px 50px rgba(0, 87, 184, .8)
        }
      }

      @keyframes bs-float {

        0%,
        100% {
          transform: translateY(0)
        }

        50% {
          transform: translateY(-5px)
        }
      }

      .bscta-wrap {
        margin-top: 36px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .bscta-eyebrow {
        font-size: 11px;
        letter-spacing: 3px;
        text-transform: uppercase;
        color: rgba(165, 200, 255, .55);
        font-weight: 600;
      }

      .bscta-btn {
        position: relative;
        overflow: hidden;
        display: inline-flex;
        align-items: center;
        gap: 14px;
        padding: 15px 40px;
        background: linear-gradient(110deg, #003d99 0%, #0057b8 25%, #00c8f0 50%, #0057b8 75%, #003d99 100%);
        background-size: 300% 100%;
        color: #fff;
        border-radius: 60px;
        font-size: 16px;
        font-weight: 800;
        letter-spacing: .4px;
        text-decoration: none;
        border: 1.5px solid rgba(255, 255, 255, .22);
        animation: bs-shimmer 3.5s linear infinite, bs-glow 2.2s ease-in-out infinite, bs-float 3.5s ease-in-out infinite;
        transition: filter .2s;
      }

      .bscta-btn::before {
        content: '';
        position: absolute;
        inset: 0;
        border-radius: 60px;
        background: linear-gradient(105deg, transparent 30%, rgba(255, 255, 255, .28) 50%, transparent 70%);
        background-size: 300% 100%;
        animation: bs-shimmer 2.2s linear infinite;
      }

      .bscta-btn:hover {
        filter: brightness(1.15);
      }

      .bscta-star {
        font-size: 20px;
        filter: drop-shadow(0 0 8px rgba(255, 255, 255, .9));
      }

      .bscta-sub {
        font-size: 11.5px;
        color: rgba(165, 200, 255, .5);
        letter-spacing: .8px;
      }
    </style>
    <div class="bscta-wrap">
      <span class="bscta-eyebrow">✦ &nbsp; Visual Reference &nbsp; ✦</span>
      <a href="bloch-sphere-diagram.html" target="_blank" class="bscta-btn">
        <span class="bscta-star">⬡</span>
        View Full Parameter Diagram
        <span style="opacity:.65;font-size:18px;">→</span>
      </a>
      <span class="bscta-sub">All axes · θ φ angles · 6 states · formula · gate rotations</span>
    </div>
  </div>

  <div class="bs-wrap">

    <!-- ── SECTION 1: WHAT IS THE BLOCH SPHERE ── -->
    <div class="bs-section">
      <div class="bs-section-hd">
        <div class="bs-icon blue">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1d4ed8" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
            <path d="M2 12h20" />
          </svg>
        </div>
        <div>
          <h2>What Is the Bloch Sphere?</h2>
          <p>Geometric representation of a single qubit</p>
        </div>
      </div>
      <div class="bs-prose">
        <p>The Bloch sphere is the most powerful geometric tool in quantum computing — it maps every possible pure state
          of a single qubit to a unique point on the surface of a unit sphere. Named after physicist <strong>Felix Bloch
            (1946)</strong>, it was originally developed to describe nuclear magnetic resonance and is now the standard
          visual language of quantum computing.</p>
        <p>A classical bit has only two states: 0 or 1. A qubit, however, exists in a <strong>continuous family of
            superpositions</strong>. The Bloch sphere makes this concrete: the north pole is |0⟩, the south pole is |1⟩,
          and every other point on the sphere is a distinct superposition state with a specific probability mixture and
          phase.</p>
        <p>The key insight: <strong>every unitary single-qubit gate is a rotation</strong> of the Bloch sphere. Quantum
          computation is, geometrically, a sequence of rigid rotations in 3D space.</p>
      </div>
      <div class="bs-divider"></div>
      <div class="bs-history">
        <div class="bs-history-icon-wrap">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="#a5b4fc" stroke-width="1.5">
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <path d="M8 8h8M8 12h8M8 16h4" />
          </svg>
        </div>
        <div class="bs-history-text">
          <h3>Historical Context</h3>
          <p>Felix Bloch introduced this representation while studying spin-1/2 particles in 1946 — the same year the
            first nuclear magnetic resonance experiments succeeded. The same mathematics that runs MRI machines in
            hospitals today underlies the qubit representations used in IBM Quantum, Google Sycamore, and IonQ
            processors.</p>
        </div>
      </div>
    </div>

    <!-- ── SECTION 2: MATHEMATICAL REPRESENTATION ── -->
    <div class="bs-section">
      <div class="bs-section-hd">
        <div class="bs-icon purple">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2">
            <path d="M4 7h16M4 12h16M4 17h10" />
          </svg>
        </div>
        <div>
          <h2>Mathematical Representation</h2>
          <p>State vector, Bloch vector, and density matrix</p>
        </div>
      </div>
      <div class="bs-prose">
        <p>The most general pure single-qubit state is written in the <strong>computational basis</strong> {|0⟩, |1⟩}
          as:</p>
      </div>

      <div class="bs-formula-grid">
        <div class="bs-formula-card">
          <div class="bs-formula-label">General Qubit State</div>
          <div class="bs-formula-math">$$|\psi\rangle = \alpha|0\rangle + \beta|1\rangle$$</div>
          <div class="bs-formula-desc">$\alpha,\beta \in \mathbb{C}$, $|\alpha|^2 + |\beta|^2 = 1$</div>
        </div>
        <div class="bs-formula-card">
          <div class="bs-formula-label">Bloch Parameterisation</div>
          <div class="bs-formula-math">$$|\psi\rangle = \cos\!\tfrac{\theta}{2}|0\rangle +
            e^{i\varphi}\sin\!\tfrac{\theta}{2}|1\rangle$$</div>
          <div class="bs-formula-desc">$\theta \in [0,\pi]$, $\varphi \in [0,2\pi)$ — two real numbers encode all
            global-phase equivalence classes</div>
        </div>
        <div class="bs-formula-card">
          <div class="bs-formula-label">Bloch Vector</div>
          <div class="bs-formula-math">$$\vec{r} = (\sin\theta\cos\varphi,\;\sin\theta\sin\varphi,\;\cos\theta)$$</div>
          <div class="bs-formula-desc">$|\vec{r}| = 1$ for pure states, $|\vec{r}| < 1$ for mixed states</div>
          </div>
          <div class="bs-formula-card">
            <div class="bs-formula-label">Density Matrix</div>
            <div class="bs-formula-math">$$\rho = \frac{I + \vec{r}\cdot\vec{\sigma}}{2}$$</div>
            <div class="bs-formula-desc">$\vec{\sigma} = (\sigma_x,\sigma_y,\sigma_z)$ Pauli vector.
              $\operatorname{Tr}(\rho)=1$, $\operatorname{Tr}(\rho^2)=1$ iff pure.</div>
          </div>
        </div>
        <div class="bs-divider"></div>
        <h3 style="font-size:16px;font-weight:700;color:var(--navy);margin-bottom:14px;">Why Only Two Angles?</h3>
        <div class="bs-prose">
          <p>A complex state vector (&#x3B1;, &#x3B2;) has 4 real degrees of freedom. The normalisation condition
            |&#x3B1;|&#xB2;+|&#x3B2;|&#xB2;=1 removes one. Global phase e^(i&#x3B3;) is physically unobservable,
            removing
            another. This leaves exactly <strong>2 real parameters</strong> — the angles &#x3B8; and &#x3C6; — which map
            perfectly onto a 2-sphere.</p>
        </div>
      </div>

      <!-- ── SECTION 3: COORDINATE BREAKDOWN ── -->
      <div class="bs-section">
        <div class="bs-section-hd">
          <div class="bs-icon green">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2">
              <path d="M12 2v20M2 12h20" />
              <circle cx="12" cy="12" r="1" />
            </svg>
          </div>
          <div>
            <h2>Coordinate System &amp; Key States</h2>
            <p>Mapping &#x3B8; and &#x3C6; to physical quantum states</p>
          </div>
        </div>

        <div class="bs-coord-grid">
          <div class="bs-coord-card x">
            <div class="bs-coord-label">X Component</div>
            <div class="bs-coord-formula">x = sin&#x3B8; cos&#x3C6;</div>
            <div class="bs-coord-desc">X-axis eigenstates: |+&#x27E9; (x=+1), |&#x2212;&#x27E9; (x=&#x2212;1)</div>
          </div>
          <div class="bs-coord-card y">
            <div class="bs-coord-label">Y Component</div>
            <div class="bs-coord-formula">y = sin&#x3B8; sin&#x3C6;</div>
            <div class="bs-coord-desc">Y-axis eigenstates: |i&#x27E9; (y=+1), |&#x2212;i&#x27E9; (y=&#x2212;1)</div>
          </div>
          <div class="bs-coord-card z">
            <div class="bs-coord-label">Z Component</div>
            <div class="bs-coord-formula">z = cos&#x3B8;</div>
            <div class="bs-coord-desc">Z-axis eigenstates: |0&#x27E9; (z=+1), |1&#x27E9; (z=&#x2212;1)</div>
          </div>
        </div>

        <table class="bs-table">
          <thead>
            <tr>
              <th>State</th>
              <th>&#x3B8;</th>
              <th>&#x3C6;</th>
              <th>Bloch Vector (x,y,z)</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><span class="tag">|0&#x27E9;</span></td>
              <td>0</td>
              <td>—</td>
              <td>(0, 0, +1)</td>
              <td>North pole — computational |0&#x27E9;</td>
            </tr>
            <tr>
              <td><span class="tag">|1&#x27E9;</span></td>
              <td>&#x3C0;</td>
              <td>—</td>
              <td>(0, 0, &#x2212;1)</td>
              <td>South pole — computational |1&#x27E9;</td>
            </tr>
            <tr>
              <td><span class="tag">|+&#x27E9;</span></td>
              <td>&#x3C0;/2</td>
              <td>0</td>
              <td>(+1, 0, 0)</td>
              <td>Hadamard basis (+X axis)</td>
            </tr>
            <tr>
              <td><span class="tag">|&#x2212;&#x27E9;</span></td>
              <td>&#x3C0;/2</td>
              <td>&#x3C0;</td>
              <td>(&#x2212;1, 0, 0)</td>
              <td>Hadamard basis (&#x2212;X axis)</td>
            </tr>
            <tr>
              <td><span class="tag">|i&#x27E9;</span></td>
              <td>&#x3C0;/2</td>
              <td>&#x3C0;/2</td>
              <td>(0, +1, 0)</td>
              <td>+Y eigenstate</td>
            </tr>
            <tr>
              <td><span class="tag">|&#x2212;i&#x27E9;</span></td>
              <td>&#x3C0;/2</td>
              <td>3&#x3C0;/2</td>
              <td>(0, &#x2212;1, 0)</td>
              <td>&#x2212;Y eigenstate</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ── SECTION 4: 3D INTERACTIVE SIMULATOR ── -->
      <div class="bs-section" id="simSection">
        <div class="bs-section-hd">
          <div class="bs-icon blue">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1d4ed8" stroke-width="2">
              <polygon points="12 2 2 7 12 12 22 7 12 2" />
              <polyline points="2 17 12 22 22 17" />
              <polyline points="2 12 12 17 22 12" />
            </svg>
          </div>
          <div>
            <h2>Interactive 3D Bloch Sphere Simulator</h2>
            <p>Drag to orbit &bull; Adjust angles &bull; Apply gates</p>
          </div>
        </div>

        <div class="bs-sim-wrap">
          <div>
            <canvas id="blochCanvas" width="380" height="380"></canvas>
          </div>
          <div class="bs-controls">
            <div class="bs-ctrl-group">
              <div class="bs-ctrl-label">State Angles</div>
              <div class="bs-range-row">
                <label>&#x3B8; (Theta)</label>
                <input type="range" min="0" max="180" value="90" id="bsTheta" oninput="bsUpdate()">
                <span id="bsThetaVal">90&#xB0;</span>
              </div>
              <div class="bs-range-row">
                <label>&#x3C6; (Phi)</label>
                <input type="range" min="0" max="360" value="0" id="bsPhi" oninput="bsUpdate()">
                <span id="bsPhiVal">0&#xB0;</span>
              </div>
              <div class="bs-range-row">
                <label>Noise (T&#x2082; decay)</label>
                <input type="range" min="0" max="1" step="0.01" value="0" id="bsNoise" oninput="bsUpdate()">
                <span id="bsNoiseVal">0.00</span>
              </div>
            </div>

            <div class="bs-ctrl-group">
              <div class="bs-ctrl-label">Current State</div>
              <div class="bs-state-pill" id="bsStatePill">|&psi;&#x27E9; = |+&#x27E9;</div>
              <div class="bs-prob-bar-wrap">
                <div class="bs-prob-bar-row">
                  <span>|0&#x27E9;</span>
                  <div class="bs-prob-track">
                    <div class="bs-prob-fill f0" id="bsBar0" style="width:50%"></div>
                  </div>
                  <span class="bs-prob-val" id="bsP0">50%</span>
                </div>
                <div class="bs-prob-bar-row">
                  <span>|1&#x27E9;</span>
                  <div class="bs-prob-track">
                    <div class="bs-prob-fill f1" id="bsBar1" style="width:50%"></div>
                  </div>
                  <span class="bs-prob-val" id="bsP1">50%</span>
                </div>
              </div>
            </div>

            <div class="bs-ctrl-group">
              <div class="bs-ctrl-label">Apply Gate</div>
              <div class="bs-gate-row">
                <button class="bs-gate-btn" onclick="bsApplyGate('X')">X</button>
                <button class="bs-gate-btn" onclick="bsApplyGate('Y')">Y</button>
                <button class="bs-gate-btn" onclick="bsApplyGate('Z')">Z</button>
                <button class="bs-gate-btn" onclick="bsApplyGate('H')">H</button>
                <button class="bs-gate-btn" onclick="bsApplyGate('S')">S</button>
                <button class="bs-gate-btn" onclick="bsApplyGate('T')">T</button>
              </div>
            </div>

            <div class="bs-ctrl-group">
              <div class="bs-ctrl-label">Measurement</div>
              <button class="bs-measure-btn" onclick="bsMeasure()">Collapse — Measure in Z-Basis</button>
              <div style="font-size:12px;color:var(--muted);margin-top:8px;" id="bsMeasureResult"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ── SECTION 5: QUANTUM GATES AS ROTATIONS ── -->
      <div class="bs-section">
        <div class="bs-section-hd">
          <div class="bs-icon amber">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#b45309" stroke-width="2">
              <path d="M21.5 2l-11.5 11.5M9.5 6L3 3l3 6.5" />
              <path d="M14.5 18L18 21l-3-6.5" />
              <circle cx="12" cy="12" r="3" />
            </svg>
          </div>
          <div>
            <h2>Quantum Gates as Bloch Sphere Rotations</h2>
            <p>Every unitary U &#x2208; SU(2) is a rotation R &#x2208; SO(3)</p>
          </div>
        </div>
        <div class="bs-prose">
          <p>This is the central theorem: there is a double cover homomorphism SU(2) &#x2192; SO(3). Every 2&#xD7;2
            unitary matrix (quantum gate) corresponds to a rotation of the Bloch sphere. The axis and angle of rotation
            are determined by the matrix itself.</p>
        </div>

        <div class="bs-gate-grid">
          <div class="bs-gate-card">
            <div class="bs-gate-card-name">X</div>
            <div class="bs-gate-card-sub">Pauli-X / Quantum NOT</div>
            <div class="bs-gate-card-action">R&#x2093;(&#x3C0;): &#x3C0; rotation around X</div>
            <div class="bs-gate-card-desc">Maps |0&#x27E9;&#x2194;|1&#x27E9;. Swaps north and south poles. Matrix:
              [[0,1],[1,0]]</div>
          </div>
          <div class="bs-gate-card">
            <div class="bs-gate-card-name">Y</div>
            <div class="bs-gate-card-sub">Pauli-Y</div>
            <div class="bs-gate-card-action">R&#x79;(&#x3C0;): &#x3C0; rotation around Y</div>
            <div class="bs-gate-card-desc">Maps |0&#x27E9;&#x2192;i|1&#x27E9;, |1&#x27E9;&#x2192;-i|0&#x27E9;. Matrix:
              [[0,-i],[i,0]]</div>
          </div>
          <div class="bs-gate-card">
            <div class="bs-gate-card-name">Z</div>
            <div class="bs-gate-card-sub">Pauli-Z / Phase Flip</div>
            <div class="bs-gate-card-action">R&#x7A;(&#x3C0;): &#x3C0; rotation around Z</div>
            <div class="bs-gate-card-desc">Maps |+&#x27E9;&#x2194;|&#x2212;&#x27E9;. Leaves |0&#x27E9;,|1&#x27E9;
              invariant. Matrix: [[1,0],[0,-1]]</div>
          </div>
          <div class="bs-gate-card">
            <div class="bs-gate-card-name">H</div>
            <div class="bs-gate-card-sub">Hadamard</div>
            <div class="bs-gate-card-action">&#x3C0; rotation around (X+Z)/&#x221A;2</div>
            <div class="bs-gate-card-desc">Swaps X and Z axes. |0&#x27E9;&#x2192;|+&#x27E9;,
              |1&#x27E9;&#x2192;|&#x2212;&#x27E9;. Foundation of superposition.</div>
          </div>
          <div class="bs-gate-card">
            <div class="bs-gate-card-name">S</div>
            <div class="bs-gate-card-sub">Phase Gate (S = T&#xB2;)</div>
            <div class="bs-gate-card-action">R&#x7A;(&#x3C0;/2): 90&#xB0; Z-rotation</div>
            <div class="bs-gate-card-desc">|1&#x27E9;&#x2192;i|1&#x27E9;. Maps |+&#x27E9;&#x2192;|i&#x27E9;. Important
              for
              Clifford group circuits.</div>
          </div>
          <div class="bs-gate-card">
            <div class="bs-gate-card-name">T</div>
            <div class="bs-gate-card-sub">&#x3C0;/8 Gate</div>
            <div class="bs-gate-card-action">R&#x7A;(&#x3C0;/4): 45&#xB0; Z-rotation</div>
            <div class="bs-gate-card-desc">|1&#x27E9;&#x2192;e^(i&#x3C0;/4)|1&#x27E9;. Essential for universal quantum
              computation (with H+CNOT).</div>
          </div>
        </div>

        <div class="bs-divider"></div>
        <div class="bs-formula-grid">
          <div class="bs-formula-card">
            <div class="bs-formula-label">General Z-Rotation</div>
            <div class="bs-formula-math">$$R_z(\theta) = e^{-i\theta\sigma_z/2} =
              \begin{pmatrix}e^{-i\theta/2}&0\\0&e^{+i\theta/2}\end{pmatrix}$$</div>
            <div class="bs-formula-desc">Rotates the Bloch vector around the Z-axis by angle $\theta$</div>
          </div>
          <div class="bs-formula-card">
            <div class="bs-formula-label">General Rotation</div>
            <div class="bs-formula-math">$$R_{\hat{n}}(\theta) = \cos\tfrac{\theta}{2}\,I -
              i\sin\tfrac{\theta}{2}\,(\hat{n}\cdot\vec{\sigma})$$</div>
            <div class="bs-formula-desc">Rotation by $\theta$ around axis $\hat{n} = (n_x, n_y, n_z)$</div>
          </div>
        </div>
      </div>

      <!-- ── SECTION 6: DENSITY MATRIX & MIXED STATES ── -->
      <div class="bs-section">
        <div class="bs-section-hd">
          <div class="bs-icon rose">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="3" />
              <path d="M9 9h6v6H9z" />
            </svg>
          </div>
          <div>
            <h2>Density Matrix &amp; Mixed States</h2>
            <p>When the Bloch vector shrinks inside the sphere</p>
          </div>
        </div>
        <div class="bs-prose">
          <p>Not all quantum states are pure (perfectly known). When qubits interact with their environment —
            <strong>decoherence</strong> — the state becomes a statistical mixture. This is represented by the
            <strong>density matrix</strong> &#x3C1;, and geometrically appears as the Bloch vector shrinking toward the
            origin.
          </p>
        </div>
        <div class="bs-dm-grid">
          <div class="bs-dm-card">
            <div class="bs-dm-title">Pure State &mdash; $|\vec{r}|=1$</div>
            <div class="bs-dm-math">
              $$\rho_{\text{pure}} = |\psi\rangle\langle\psi| = \frac{1}{2}\begin{pmatrix}1+z & x-iy \\ x+iy &
              1-z\end{pmatrix}$$
              $$\operatorname{Tr}(\rho)=1 \qquad \operatorname{Tr}(\rho^2)=1$$
            </div>
            <div class="bs-dm-note">On the Bloch sphere surface. Perfectly coherent. No environmental entanglement.
            </div>
          </div>
          <div class="bs-dm-card">
            <div class="bs-dm-title">Mixed State &mdash; $|\vec{r}|<1$< /div>
                <div class="bs-dm-math">
                  $$\rho = \frac{I + \vec{r}\cdot\vec{\sigma}}{2}, \quad |\vec{r}|=0 \Rightarrow \rho=\frac{I}{2}$$
                  $$\operatorname{Tr}(\rho)=1 \qquad \operatorname{Tr}(\rho^2)<1$$ </div>
                    <div class="bs-dm-note">Inside the Bloch ball. Decoherence shrinks $|\vec{r}|$ exponentially:
                      $|\vec{r}(t)| \propto e^{-t/T_2}$</div>
                </div>
            </div>
            <div class="bs-formula-grid" style="margin-top:16px;">
              <div class="bs-formula-card">
                <div class="bs-formula-label">T&#x2081; Relaxation</div>
                <div class="bs-formula-math">$$P(|1\rangle, t) = e^{-t/T_1}$$</div>
                <div class="bs-formula-desc">Energy decay from excited $|1\rangle$ to ground $|0\rangle$ state. $T_1
                  \sim 10\,\mu\text{s}\text{–}1\,\text{ms}$ on modern qubits.</div>
              </div>
              <div class="bs-formula-card">
                <div class="bs-formula-label">T&#x2082; Dephasing</div>
                <div class="bs-formula-math">$$\langle\sigma_x\rangle(t) = e^{-t/T_2}$$</div>
                <div class="bs-formula-desc">Phase coherence decay. The Bloch vector contracts in the $XY$-plane. Always
                  $T_2 \leq 2T_1$.</div>
              </div>
            </div>
          </div>

        </div><!-- /bs-wrap -->

        <!-- FIREWORKS -->
        <canvas id="fw"></canvas>

        <script>
          /* ───────────────────────────────────────────────────────────
             THREE.JS — Premium Bloch Sphere Renderer
          ─────────────────────────────────────────────────────────── */
          (function () {
            const canvas = document.getElementById('blochCanvas');
            const W = 380, H = 380;
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(40, W / H, 0.1, 100);
            camera.position.set(2.2, 1.4, 2.2);
            camera.lookAt(0, 0, 0);

            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
            renderer.setSize(W, H);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 0);

            // Ambient + directional light
            scene.add(new THREE.AmbientLight(0x6699ff, 0.6));
            const dl = new THREE.DirectionalLight(0xffffff, 1.0);
            dl.position.set(3, 4, 2);
            scene.add(dl);

            // Sphere — translucent with nice material
            const sphereMesh = new THREE.Mesh(
              new THREE.SphereGeometry(1, 48, 48),
              new THREE.MeshPhongMaterial({
                color: 0x2563eb, transparent: true, opacity: 0.10,
                shininess: 60, side: THREE.DoubleSide
              })
            );
            scene.add(sphereMesh);

            // Wireframe overlay
            const wireGeo = new THREE.SphereGeometry(1.002, 20, 20);
            const wireMat = new THREE.MeshBasicMaterial({ color: 0x3b82f6, wireframe: true, transparent: true, opacity: 0.18 });
            scene.add(new THREE.Mesh(wireGeo, wireMat));

            // Equator circle
            const eqGeo = new THREE.RingGeometry(0.998, 1.002, 80);
            const eqMat = new THREE.MeshBasicMaterial({ color: 0x60a5fa, side: THREE.DoubleSide, transparent: true, opacity: 0.5 });
            const equator = new THREE.Mesh(eqGeo, eqMat);
            equator.rotation.x = Math.PI / 2;
            scene.add(equator);

            // Axes
            const axes = new THREE.AxesHelper(1.6);
            scene.add(axes);

            // Axis labels (sprites)
            function makeLabel(text, color) {
              const c2 = document.createElement('canvas');
              c2.width = 128; c2.height = 64;
              const c = c2.getContext('2d');
              c.font = 'bold 36px JetBrains Mono, monospace';
              c.fillStyle = color;
              c.textAlign = 'center';
              c.textBaseline = 'middle';
              c.fillText(text, 64, 32);
              const tex = new THREE.CanvasTexture(c2);
              const mat = new THREE.SpriteMaterial({ map: tex, transparent: true });
              const sp = new THREE.Sprite(mat);
              sp.scale.set(0.4, 0.2, 1);
              return sp;
            }
            const lx = makeLabel('+X', '#ef4444'); lx.position.set(1.75, 0.05, 0); scene.add(lx);
            const ly = makeLabel('+Y', '#f97316'); ly.position.set(0, 0.05, 1.75); scene.add(ly);
            const l0 = makeLabel('|0⟩', '#6ee7b7'); l0.position.set(0, 1.75, 0); scene.add(l0);
            const l1 = makeLabel('|1⟩', '#c084fc'); l1.position.set(0, -1.75, 0); scene.add(l1);

            // State arrow
            const arrowDir = new THREE.Vector3(0, 1, 0);
            const arrow = new THREE.ArrowHelper(arrowDir, new THREE.Vector3(0, 0, 0), 1, 0xff4444, 0.18, 0.10);
            scene.add(arrow);

            // State dot
            const dotMesh = new THREE.Mesh(
              new THREE.SphereGeometry(0.055, 16, 16),
              new THREE.MeshPhongMaterial({ color: 0xff4444, emissive: 0xff2200, emissiveIntensity: 0.4 })
            );
            scene.add(dotMesh);

            // Orbit controls (manual)
            let isDragging = false, prevX = 0, prevY = 0, rotX = 0.5, rotY = 0.3;
            canvas.addEventListener('mousedown', e => { isDragging = true; prevX = e.clientX; prevY = e.clientY; });
            window.addEventListener('mouseup', () => isDragging = false);
            window.addEventListener('mousemove', e => {
              if (!isDragging) return;
              rotY += (e.clientX - prevX) * 0.008;
              rotX += (e.clientY - prevY) * 0.008;
              rotX = Math.max(-Math.PI / 2 + 0.1, Math.min(Math.PI / 2 - 0.1, rotX));
              prevX = e.clientX; prevY = e.clientY;
            });
            canvas.addEventListener('touchstart', e => { isDragging = true; prevX = e.touches[0].clientX; prevY = e.touches[0].clientY; }, { passive: true });
            window.addEventListener('touchend', () => isDragging = false);
            window.addEventListener('touchmove', e => {
              if (!isDragging) return;
              rotY += (e.touches[0].clientX - prevX) * 0.010;
              rotX += (e.touches[0].clientY - prevY) * 0.010;
              rotX = Math.max(-Math.PI / 2 + 0.1, Math.min(Math.PI / 2 - 0.1, rotX));
              prevX = e.touches[0].clientX; prevY = e.touches[0].clientY;
            }, { passive: true });

            let bsTheta = Math.PI / 2, bsPhi = 0, noiseLevel = 0;
            let decayFactor = 1.0; // for decoherence

            window.bsUpdate = function () {
              bsTheta = +document.getElementById('bsTheta').value * Math.PI / 180;
              bsPhi = +document.getElementById('bsPhi').value * Math.PI / 180;
              noiseLevel = +document.getElementById('bsNoise').value;
              document.getElementById('bsThetaVal').textContent = (+document.getElementById('bsTheta').value).toFixed(0) + '°';
              document.getElementById('bsPhiVal').textContent = (+document.getElementById('bsPhi').value).toFixed(0) + '°';
              document.getElementById('bsNoiseVal').textContent = noiseLevel.toFixed(2);
              decayFactor = 1.0;
              updateProbs();
            };

            function updateProbs() {
              const p0 = Math.cos(bsTheta / 2) ** 2;
              const p1 = Math.sin(bsTheta / 2) ** 2;
              document.getElementById('bsBar0').style.width = (p0 * 100).toFixed(1) + '%';
              document.getElementById('bsBar1').style.width = (p1 * 100).toFixed(1) + '%';
              document.getElementById('bsP0').textContent = (p0 * 100).toFixed(1) + '%';
              document.getElementById('bsP1').textContent = (p1 * 100).toFixed(1) + '%';
              const labels = ['|0⟩', '|1⟩', '|+⟩', '|−⟩', '|i⟩', '|−i⟩'];
              const th = bsTheta, ph = bsPhi;
              let lbl;
              if (th < 0.05) lbl = '|0⟩'; else if (th > Math.PI - 0.05) lbl = '|1⟩';
              else if (Math.abs(th - Math.PI / 2) < 0.05) {
                if (ph < 0.05) lbl = '|+⟩'; else if (Math.abs(ph - Math.PI) < 0.1) lbl = '|−⟩';
                else if (Math.abs(ph - Math.PI / 2) < 0.1) lbl = '|i⟩'; else lbl = '|ψ⟩';
              } else lbl = '|ψ⟩';
              document.getElementById('bsStatePill').innerHTML =
                `|ψ⟩ = cos(${(th / 2).toFixed(2)})|0⟩ + e<sup>i${ph.toFixed(2)}</sup>sin(${(th / 2).toFixed(2)})|1⟩ <br><span style="color:var(--sky);font-size:12px;">≈ ${lbl}</span>`;
            }

            window.bsApplyGate = function (g) {
              // Convert current (theta, phi) → Bloch vector (x, y, z)
              // Renderer convention: y = cos(theta), x = sin(theta)*cos(phi), z = sin(theta)*sin(phi)
              let x = Math.sin(bsTheta) * Math.cos(bsPhi);
              let y = Math.cos(bsTheta);
              let z = Math.sin(bsTheta) * Math.sin(bsPhi);

              // RENDERER CONVENTION:
              //   y-axis = computational Z (|0⟩ at +y, |1⟩ at -y)
              //   x-axis = Hadamard/X     (|+⟩ at +x, |−⟩ at -x)
              //   z-axis = Phase/Y        (|+i⟩ at +z, |−i⟩ at -z)
              let nx, ny, nz;
              switch (g) {
                case 'X':
                  // Pauli-X: π rotation around renderer-x axis: (x,y,z)→(x,-y,-z)
                  nx = x; ny = -y; nz = -z; break;

                case 'Y':
                  // Pauli-Y: π rotation around renderer-z (phase/Y axis): (x,y,z)→(-x,-y,z)
                  nx = -x; ny = -y; nz = z; break;

                case 'Z':
                  // Pauli-Z: π rotation around renderer-y (computational axis): (x,y,z)→(-x,y,-z)
                  nx = -x; ny = y; nz = -z; break;

                case 'H': {
                  // Hadamard: swap computational-Z ↔ Hadamard-X
                  // In renderer: swap x ↔ y, negate z
                  // H|0⟩=|+⟩: (0,+1,0) → (+1,0,0) ✓
                  // H|+⟩=|0⟩: (+1,0,0) → (0,+1,0) ✓
                  // H|1⟩=|-⟩: (0,-1,0) → (-1,0,0) ✓
                  nx = y; ny = x; nz = -z; break;
                }

                case 'S': {
                  // S = φ += π/2: rotate xz-plane by π/2
                  const a = Math.PI / 2;
                  nx = x * Math.cos(a) - z * Math.sin(a);
                  ny = y;
                  nz = x * Math.sin(a) + z * Math.cos(a);
                  break;
                }

                case 'T': {
                  // T = φ += π/4: rotate xz-plane by π/4
                  const b = Math.PI / 4;
                  nx = x * Math.cos(b) - z * Math.sin(b);
                  ny = y;
                  nz = x * Math.sin(b) + z * Math.cos(b);
                  break;
                }

                default: nx = x; ny = y; nz = z;
              }

              // Normalise (defensive)
              const len = Math.sqrt(nx * nx + ny * ny + nz * nz);
              if (len > 1e-6) { nx /= len; ny /= len; nz /= len; }

              // Convert back to spherical: y = cos(theta)
              bsTheta = Math.acos(Math.max(-1, Math.min(1, ny)));
              bsPhi = Math.atan2(nz, nx);
              if (bsPhi < 0) bsPhi += 2 * Math.PI;

              document.getElementById('bsTheta').value = (bsTheta * 180 / Math.PI).toFixed(1);
              document.getElementById('bsPhi').value = (bsPhi * 180 / Math.PI).toFixed(1);
              document.getElementById('bsThetaVal').textContent = (bsTheta * 180 / Math.PI).toFixed(0) + '°';
              document.getElementById('bsPhiVal').textContent = (bsPhi * 180 / Math.PI).toFixed(0) + '°';
              decayFactor = 1.0;
              updateProbs();
            };

            window.bsMeasure = function () {
              const p0 = Math.cos(bsTheta / 2) ** 2;
              const outcome = Math.random() < p0 ? 0 : 1;
              bsTheta = outcome === 0 ? 0 : Math.PI;
              bsPhi = 0; decayFactor = 1.0;
              document.getElementById('bsTheta').value = (bsTheta * 180 / Math.PI).toFixed(0);
              document.getElementById('bsPhi').value = 0;
              document.getElementById('bsThetaVal').textContent = (bsTheta * 180 / Math.PI).toFixed(0) + '°';
              document.getElementById('bsPhiVal').textContent = '0°';
              document.getElementById('bsMeasureResult').innerHTML = `Collapsed to <strong style="color:${outcome === 0 ? '#0057b8' : '#7c3aed'}">|${outcome}⟩</strong> — P = ${(outcome === 0 ? p0 : 1 - p0).toFixed(3)}`;
              updateProbs();
              if (typeof startFireworks === 'function') startFireworks();
            };

            // Animation loop
            function animate() {
              requestAnimationFrame(animate);
              // Noise / decoherence
              if (noiseLevel > 0) decayFactor = Math.max(0, decayFactor - noiseLevel * 0.003);
              const r = decayFactor;
              const vx = r * Math.sin(bsTheta) * Math.cos(bsPhi);
              const vy = r * Math.cos(bsTheta);
              const vz = r * Math.sin(bsTheta) * Math.sin(bsPhi);
              const dir = new THREE.Vector3(vx, vy, vz);
              const len = dir.length();
              if (len > 0.01) { dir.normalize(); arrow.setDirection(dir); arrow.setLength(len, 0.18 * len, 0.10 * len); arrow.visible = true; }
              else { arrow.visible = false; }
              dotMesh.position.set(vx, vy, vz);
              // Orbit camera
              const R = 3.2;
              camera.position.set(
                R * Math.cos(rotX) * Math.sin(rotY),
                R * Math.sin(rotX),
                R * Math.cos(rotX) * Math.cos(rotY)
              );
              camera.lookAt(0, 0, 0);
              renderer.render(scene, camera);
            }
            animate();
            updateProbs();
          })();

          /* ── Fireworks ── */
          (function () {
            const fw = document.getElementById('fw');
            const ctx = fw.getContext('2d');
            fw.width = window.innerWidth; fw.height = window.innerHeight;
            window.startFireworks = function () {
              fw.style.display = 'block';
              let parts = [];
              for (let i = 0; i < 80; i++) parts.push({ x: fw.width / 2, y: fw.height * 0.4, vx: (Math.random() - 0.5) * 8, vy: (Math.random() - 0.5) * 8, life: 70, c: `hsl(${Math.random() * 360},90%,65%)` });
              (function draw() {
                ctx.clearRect(0, 0, fw.width, fw.height);
                parts.forEach(p => { ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y, 3, 3); p.x += p.vx; p.y += p.vy; p.vy += 0.1; p.life--; });
                parts = parts.filter(p => p.life > 0);
                if (parts.length) requestAnimationFrame(draw); else fw.style.display = 'none';
              })();
            };
            window.addEventListener('resize', () => { fw.width = window.innerWidth; fw.height = window.innerHeight; });
          })();
        </script>
        <script src="global-ui.js"></script>


        <!-- ── Advanced Bloch Sphere Quiz (self-contained) ─────────────────────── -->
        <style>
          /* ── Advanced Quiz ─────────────────────────────────────────────────────── */
          .adv-quiz-section {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, .08);
            margin: 28px 0;
            padding: 28px;
          }

          .adv-quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 14px;
          }

          .adv-quiz-title {
            font-size: 15px;
            font-weight: 700;
            color: #003366;
            text-transform: uppercase;
            letter-spacing: .08em;
            display: flex;
            align-items: center;
            gap: 7px;
          }

          .adv-quiz-title::before {
            content: '';
            display: inline-block;
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #0057b8;
            box-shadow: 0 0 8px #0057b8;
          }

          .adv-quiz-prog-label {
            font-size: 13px;
            color: #64748b;
            font-weight: 500;
          }

          .adv-quiz-bar {
            height: 5px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-bottom: 18px;
            overflow: hidden;
          }

          .adv-quiz-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #0057b8, #00b4d8);
            border-radius: 4px;
            transition: width .35s ease;
          }

          .adv-quiz-card {
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            padding: 26px 28px;
            box-shadow: 0 4px 16px rgba(0, 70, 150, .07);
          }

          .adv-quiz-q {
            font-size: 17px;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.55;
            margin-bottom: 20px;
          }

          .adv-quiz-opts {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 18px;
          }

          .adv-quiz-opt {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 13px 16px;
            cursor: pointer;
            transition: all .22s;
            display: flex;
            align-items: center;
            gap: 14px;
          }

          .adv-quiz-opt:hover {
            border-color: #0057b8;
            background: rgba(0, 87, 184, .05);
          }

          .adv-quiz-opt.selected {
            border-color: #0057b8;
            background: rgba(0, 87, 184, .12);
          }

          .adv-quiz-opt.correct {
            border-color: #10b981;
            background: rgba(16, 185, 129, .12);
          }

          .adv-quiz-opt.incorrect {
            border-color: #ef4444;
            background: rgba(239, 68, 68, .12);
          }

          .adv-quiz-opt.disabled {
            cursor: not-allowed;
          }

          .adv-opt-letter {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #cbd5e1;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 13px;
            color: #64748b;
            flex-shrink: 0;
            transition: all .22s;
          }

          .adv-quiz-opt.selected .adv-opt-letter {
            background: #0057b8;
            border-color: #0057b8;
            color: #fff;
          }

          .adv-quiz-opt.correct .adv-opt-letter {
            background: #10b981;
            border-color: #10b981;
            color: #fff;
          }

          .adv-quiz-opt.incorrect .adv-opt-letter {
            background: #ef4444;
            border-color: #ef4444;
            color: #fff;
          }

          .adv-opt-text {
            flex: 1;
            font-size: 15px;
            color: #475569;
            line-height: 1.4;
          }

          .adv-quiz-opt.selected .adv-opt-text {
            color: #1e293b;
          }

          .adv-quiz-explain {
            display: none;
            margin-top: 14px;
            background: #eef6ff;
            border-left: 4px solid #0057b8;
            border-radius: 8px;
            padding: 14px 16px;
          }

          .adv-quiz-explain.show {
            display: block;
            animation: aqSlide .3s ease;
          }

          .adv-explain-title {
            font-size: 11px;
            font-weight: 700;
            color: #0057b8;
            text-transform: uppercase;
            letter-spacing: .1em;
            margin-bottom: 5px;
          }

          .adv-explain-text {
            font-size: 14px;
            color: #334155;
            line-height: 1.6;
          }

          .adv-quiz-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
          }

          .adv-quiz-btn {
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all .2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
          }

          .adv-quiz-btn:disabled {
            opacity: .45;
            cursor: not-allowed;
          }

          .adv-quiz-btn-primary {
            background: linear-gradient(135deg, #0057b8, #0094d4);
            color: #fff;
          }

          .adv-quiz-btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 87, 184, .35);
          }

          .adv-quiz-btn-secondary {
            background: transparent;
            border: 2px solid #e2e8f0;
            color: #475569;
          }

          .adv-quiz-btn-secondary:hover:not(:disabled) {
            border-color: #0057b8;
            color: #0057b8;
          }

          .adv-quiz-results {
            background: #fff;
            border: 2px solid #0057b8;
            border-radius: 14px;
            padding: 36px;
            text-align: center;
            display: none;
          }

          .adv-quiz-results.show {
            display: block;
            animation: aqZoom .4s ease;
          }

          .adv-quiz-score-pct {
            font-size: 60px;
            font-weight: 800;
            background: linear-gradient(135deg, #0057b8, #00b4d8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
          }

          .adv-quiz-score-label {
            font-size: 20px;
            color: #475569;
            margin: 8px 0 4px;
          }

          .adv-quiz-score-detail {
            font-size: 15px;
            color: #94a3b8;
            margin-bottom: 20px;
          }

          .adv-quiz-feedback {
            font-size: 17px;
            color: #1e293b;
            background: #eef6ff;
            border-radius: 10px;
            padding: 16px 20px;
            margin-bottom: 22px;
          }

          @keyframes aqSlide {
            from {
              opacity: 0;
              transform: translateY(-8px)
            }

            to {
              opacity: 1;
              transform: translateY(0)
            }
          }

          @keyframes aqZoom {
            from {
              opacity: 0;
              transform: scale(.92)
            }

            to {
              opacity: 1;
              transform: scale(1)
            }
          }
        </style>

        <div style="max-width:1100px;margin:28px auto;padding:0 24px;">
          <div class="adv-quiz-section">
            <div id="advQuizMount_blochQuizData"></div>
          </div>
        </div>

        <script>
          (function () {

            class AdvQuiz {
              constructor(data, mountId) {
                this.data = data; this.mount = document.getElementById(mountId);
                this.cur = 0; this.score = 0; this.answers = []; this.answered = false;
                this.render();
              }
              render() {
                if (!this.mount) return;
                const q = this.data.questions[this.cur];
                const pct = (this.cur / this.data.questions.length) * 100;
                this.mount.innerHTML = `
      <div class="adv-quiz-header">
        <div class="adv-quiz-title">${this.data.topicName} Quiz</div>
        <div class="adv-quiz-prog-label">Q${this.cur + 1}&nbsp;/&nbsp;${this.data.questions.length}</div>
      </div>
      <div class="adv-quiz-bar"><div class="adv-quiz-bar-fill" style="width:${pct}%"></div></div>
      <div class="adv-quiz-card">
        <div class="adv-quiz-q">${q.question}</div>
        <div class="adv-quiz-opts">
          ${q.options.map((o, i) => `
            <div class="adv-quiz-opt" data-i="${i}">
              <div class="adv-opt-letter">${'ABCD'[i]}</div>
              <div class="adv-opt-text">${o}</div>
            </div>`).join('')}
        </div>
        <div class="adv-quiz-explain" id="aqqExp">
          <div class="adv-explain-title">Explanation</div>
          <div class="adv-explain-text">${q.explanation}</div>
        </div>
      </div>
      <div class="adv-quiz-controls">
        <button class="adv-quiz-btn adv-quiz-btn-secondary" id="aqPrev" ${this.cur === 0 ? 'disabled' : ''}>&larr; Prev</button>
        <button class="adv-quiz-btn adv-quiz-btn-primary" id="aqSubmit" disabled>Submit</button>
        <button class="adv-quiz-btn adv-quiz-btn-secondary" id="aqNext" style="display:none">Next &rarr;</button>
      </div>`;
                this.restoreAnswer(); this.bind();
              }
              bind() {
                this.mount.querySelectorAll('.adv-quiz-opt').forEach(el => el.addEventListener('click', () => { if (!this.answered) this.select(el); }));
                const sub = this.mount.querySelector('#aqSubmit'); if (sub) sub.addEventListener('click', () => this.submit());
                const prv = this.mount.querySelector('#aqPrev'); if (prv) prv.addEventListener('click', () => { this.cur--; this.answered = !!this.answers[this.cur]; this.render(); });
                const nxt = this.mount.querySelector('#aqNext'); if (nxt) nxt.addEventListener('click', () => {
                  if (this.cur < this.data.questions.length - 1) { this.cur++; this.answered = !!this.answers[this.cur]; this.render(); }
                  else this.showResults();
                });
              }
              select(el) {
                this.mount.querySelectorAll('.adv-quiz-opt').forEach(o => o.classList.remove('selected'));
                el.classList.add('selected');
                const sub = this.mount.querySelector('#aqSubmit'); if (sub) sub.disabled = false;
              }
              submit() {
                const sel = this.mount.querySelector('.adv-quiz-opt.selected'); if (!sel) return;
                this.answered = true;
                const i = parseInt(sel.dataset.i), q = this.data.questions[this.cur], ok = i === q.correct;
                if (ok && !this.answers[this.cur]) this.score++;
                this.answers[this.cur] = { selected: i, correct: ok };
                this.mount.querySelectorAll('.adv-quiz-opt').forEach((o, idx) => {
                  o.classList.add('disabled');
                  if (idx === q.correct) o.classList.add('correct');
                  else if (idx === i && !ok) o.classList.add('incorrect');
                });
                const exp = this.mount.querySelector('#aqqExp'); if (exp) exp.classList.add('show');
                const sub = this.mount.querySelector('#aqSubmit'); if (sub) sub.style.display = 'none';
                const nxt = this.mount.querySelector('#aqNext'); if (nxt) {
                  nxt.style.display = 'inline-flex';
                  if (this.cur === this.data.questions.length - 1) nxt.textContent = 'View Results';
                }
                if (ok && typeof startFireworks === 'function') startFireworks();
              }
              restoreAnswer() {
                const prev = this.answers[this.cur]; if (!prev) return;
                this.answered = true;
                const q = this.data.questions[this.cur];
                this.mount.querySelectorAll('.adv-quiz-opt').forEach((o, idx) => {
                  o.classList.add('disabled');
                  if (idx === q.correct) o.classList.add('correct');
                  if (idx === prev.selected) { o.classList.add('selected'); if (!prev.correct) o.classList.add('incorrect'); }
                });
                const exp = this.mount.querySelector('#aqqExp'); if (exp) exp.classList.add('show');
                const sub = this.mount.querySelector('#aqSubmit'); if (sub) sub.style.display = 'none';
                const nxt = this.mount.querySelector('#aqNext'); if (nxt) nxt.style.display = 'inline-flex';
              }
              showResults() {
                const pct = Math.round((this.score / this.data.questions.length) * 100);
                const fb = pct >= 90 ? 'Outstanding! You have mastered this topic!' : pct >= 70 ? 'Great job! Solid understanding of the concepts.' : pct >= 50 ? 'Good effort! Review the material to strengthen your understanding.' : 'Keep learning! Re-read the theory and try again.';
                this.mount.innerHTML = `
      <div class="adv-quiz-results show">
        <div class="adv-quiz-score-pct">${pct}%</div>
        <div class="adv-quiz-score-label">Your Score</div>
        <div class="adv-quiz-score-detail">${this.score} out of ${this.data.questions.length} correct</div>
        <div class="adv-quiz-feedback">${fb}</div>
        <div class="adv-quiz-controls">
          <button class="adv-quiz-btn adv-quiz-btn-secondary" onclick="location.reload()">Try Again</button>
        </div>
      </div>`;
              }
            }

            const blochQuizData = {
              topicName: "Bloch Sphere",
              questions: [
                {
                  question: "What does a point on the Bloch sphere represent?",
                  options: ["A classical bit value", "The physical location of an electron", "A pure single-qubit quantum state", "An entangled pair of qubits"],
                  correct: 2,
                  explanation: "The Bloch sphere is a geometric representation where every unit vector on the sphere corresponds to a unique pure single-qubit state."
                },
                {
                  question: "Where does |0⟩ sit on the standard Bloch sphere?",
                  options: ["South pole", "Equator", "North pole", "Random position"],
                  correct: 2,
                  explanation: "By convention, |0⟩ (θ=0) sits at the north pole (+Z axis). |1⟩ is at the south pole (−Z)."
                },
                {
                  question: "Which gate moves |0⟩ from the north pole to the equator (+X)?",
                  options: ["Pauli-Z", "Pauli-X", "CNOT", "Hadamard (H)"],
                  correct: 3,
                  explanation: "Hadamard transforms |0⟩ → (|0⟩+|1⟩)/√2 = |+⟩, which lives on the equator at +X."
                },
                {
                  question: "What is θ for the |1⟩ state on the Bloch sphere?",
                  options: ["θ=0", "θ=π/2", "θ=π", "θ=π/4"],
                  correct: 2,
                  explanation: "|1⟩ is at the south pole: θ = π (180°)."
                },
                {
                  question: "What does Pauli-X do on the Bloch sphere?",
                  options: ["Rotates π around X-axis", "Rotates π/2 around Z-axis", "Leaves the state unchanged", "Moves the state to the equator"],
                  correct: 0,
                  explanation: "Pauli-X performs a 180° rotation around the X-axis, flipping |0⟩ ↔ |1⟩ — the quantum NOT gate."
                },
                {
                  question: "Which state sits at the equator with azimuthal angle φ=0?",
                  options: ["|0⟩", "|1⟩", "|+⟩ = (|0⟩+|1⟩)/√2", "|i⟩ = (|0⟩+i|1⟩)/√2"],
                  correct: 2,
                  explanation: "Equator points (θ=π/2) with φ=0 correspond to |+⟩ and with φ=π to |−⟩."
                },
                {
                  question: "What does the S gate do on the Bloch sphere equator?",
                  options: ["Rotates π/2 around Z-axis", "Flips to opposite pole", "Moves to north pole", "Has no effect"],
                  correct: 0,
                  explanation: "The S gate applies a π/2 phase, equivalent to a 90° rotation around the Z-axis on the Bloch sphere."
                },
                {
                  question: "What does noise do to the Bloch vector over time?",
                  options: ["Moves it to north pole", "Extends it beyond the unit sphere", "Shrinks it toward the center (mixed state)", "Has no effect"],
                  correct: 2,
                  explanation: "Decoherence shrinks the Bloch vector. Length < 1 → mixed state. Length = 0 → completely mixed state."
                },
              ]
            };
            // Wait for DOM to be ready
            if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', function () { new AdvQuiz(blochQuizData, 'advQuizMount_blochQuizData'); });
            } else {
              new AdvQuiz(blochQuizData, 'advQuizMount_blochQuizData');
            }
          })();
        </script>

        <!-- QT-ENHANCEMENTS-v1 -->
        <style>
          /* ── QT Enhancements ─────────────────────────────────────────────────── */
          .qt-enhance-wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 24px 48px;
          }

          /* Key Concepts */
          .qt-concepts {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 18px rgba(0, 40, 120, .08);
            padding: 28px 32px;
            margin-bottom: 24px;
          }

          .qt-concepts-title {
            font-size: 13px;
            font-weight: 700;
            letter-spacing: .12em;
            color: #0057b8;
            text-transform: uppercase;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
          }

          .qt-concepts-title::before {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0057b8, #00b4d8);
            display: inline-block;
            flex-shrink: 0;
          }

          .qt-concepts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
          }

          .qt-concept-card {
            background: linear-gradient(135deg, #f0f7ff, #e8f4ff);
            border: 1.5px solid #c7deff;
            border-radius: 12px;
            padding: 16px 18px;
            position: relative;
            overflow: hidden;
          }

          .qt-concept-card::before {
            content: '';
            position: absolute;
            top: -20px;
            right: -20px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0, 87, 184, .07);
          }

          .qt-concept-card h4 {
            margin: 0 0 7px;
            font-size: 14px;
            color: #003380;
            font-weight: 700;
          }

          .qt-concept-card p {
            margin: 0;
            font-size: 13px;
            color: #475569;
            line-height: 1.6;
          }

          .qt-concept-card.green {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-color: #86efac;
          }

          .qt-concept-card.green h4 {
            color: #166534;
          }

          .qt-concept-card.purple {
            background: linear-gradient(135deg, #faf5ff, #ede9fe);
            border-color: #c4b5fd;
          }

          .qt-concept-card.purple h4 {
            color: #581c87;
          }

          .qt-concept-card.orange {
            background: linear-gradient(135deg, #fff7ed, #ffedd5);
            border-color: #fed7aa;
          }

          .qt-concept-card.orange h4 {
            color: #9a3412;
          }

          /* Formula reference */
          .qt-formula-box {
            background: #0f172a;
            border-radius: 14px;
            padding: 24px 28px;
            margin-bottom: 24px;
            color: #e2e8f0;
          }

          .qt-formula-box-title {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: .15em;
            color: #38bdf8;
            text-transform: uppercase;
            margin-bottom: 16px;
          }

          .qt-formula-row {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, .06);
          }

          .qt-formula-row:last-child {
            border-bottom: none;
          }

          .qt-formula-tag {
            background: rgba(56, 189, 248, .15);
            border: 1px solid rgba(56, 189, 248, .3);
            color: #38bdf8;
            font-size: 11px;
            font-weight: 700;
            padding: 3px 9px;
            border-radius: 20px;
            white-space: nowrap;
            flex-shrink: 0;
          }

          .qt-formula-math {
            font-family: 'Courier New', monospace;
            font-size: 15px;
            color: #f1f5f9;
            flex: 1;
          }

          .qt-formula-desc {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 3px;
          }

          /* Did You Know */
          .qt-dyk {
            background: linear-gradient(135deg, #1e1b4b, #312e81);
            border-radius: 14px;
            padding: 22px 26px;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            color: #fff;
          }

          .qt-dyk-icon {
            font-size: 28px;
            flex-shrink: 0;
            margin-top: 2px;
          }

          .qt-dyk-title {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: .14em;
            color: #a5b4fc;
            text-transform: uppercase;
            margin-bottom: 6px;
          }

          .qt-dyk-text {
            font-size: 14px;
            color: #e0e7ff;
            line-height: 1.7;
          }

          /* Notebook */
          .qt-notebook {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 18px rgba(0, 40, 120, .1);
            overflow: hidden;
            margin-bottom: 24px;
          }

          .qt-nb-header {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            padding: 16px 22px;
            display: flex;
            align-items: center;
            gap: 10px;
          }

          .qt-nb-dots {
            display: flex;
            gap: 6px;
          }

          .qt-nb-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
          }

          .qt-nb-dot.red {
            background: #ff5f57;
          }

          .qt-nb-dot.yellow {
            background: #febc2e;
          }

          .qt-nb-dot.green {
            background: #28c840;
          }

          .qt-nb-title {
            color: #94a3b8;
            font-size: 13px;
            font-family: monospace;
            margin-left: 8px;
          }

          .qt-nb-body {
            padding: 20px 22px;
          }

          .qt-nb-label {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: .12em;
            color: #0057b8;
            text-transform: uppercase;
            margin-bottom: 8px;
          }

          .qt-nb-tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 12px;
            flex-wrap: wrap;
          }

          .qt-nb-tab {
            padding: 5px 13px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            border: 1.5px solid #e2e8f0;
            color: #64748b;
            background: #f8fafc;
            transition: all .18s;
          }

          .qt-nb-tab:hover,
          .qt-nb-tab.active {
            background: #0057b8;
            border-color: #0057b8;
            color: #fff;
          }

          .qt-nb-editor {
            position: relative;
          }

          .qt-nb-code {
            width: 100%;
            min-height: 120px;
            background: #0f172a;
            color: #a5f3fc;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.7;
            border: 2px solid #1e293b;
            border-radius: 10px;
            padding: 14px;
            resize: vertical;
            outline: none;
            box-sizing: border-box;
            transition: border-color .2s;
          }

          .qt-nb-code:focus {
            border-color: #0057b8;
          }

          .qt-nb-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
          }

          .qt-nb-run {
            background: linear-gradient(135deg, #0057b8, #0094d4);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 9px 22px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all .2s;
          }

          .qt-nb-run:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 87, 184, .4);
          }

          .qt-nb-clear {
            background: transparent;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 9px 16px;
            font-size: 13px;
            color: #64748b;
            cursor: pointer;
            transition: all .2s;
          }

          .qt-nb-clear:hover {
            border-color: #ef4444;
            color: #ef4444;
          }

          .qt-nb-output {
            margin-top: 14px;
            background: #f8fafc;
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            padding: 14px 16px;
            min-height: 56px;
            font-family: monospace;
            font-size: 13px;
            color: #334155;
            white-space: pre-wrap;
            line-height: 1.7;
          }

          .qt-nb-output.error {
            background: #fff1f2;
            border-color: #fca5a5;
            color: #991b1b;
          }

          .qt-nb-output.success {
            background: #f0fdf4;
            border-color: #86efac;
            color: #166534;
          }

          @media(max-width:600px) {
            .qt-concepts-grid {
              grid-template-columns: 1fr;
            }

            .qt-formula-row {
              flex-direction: column;
              gap: 6px;
            }
          }
        </style>
        <div class="qt-enhance-wrap">

          <!-- Key Concepts -->
          <div class="qt-concepts">
            <div class="qt-concepts-title">Key Concepts</div>
            <div class="qt-concepts-grid">
              <div class="qt-concept-card">
                <h4>🌐 Bloch Sphere</h4>
                <p>Every pure single-qubit state maps to a unique point on the unit sphere. Mixed states live inside the
                  ball.
                </p>
              </div>
              <div class="qt-concept-card green">
                <h4>🔺 North/South Poles</h4>
                <p>|0⟩ = north pole (θ=0). |1⟩ = south pole (θ=π). All computational basis states are at the poles.</p>
              </div>
              <div class="qt-concept-card purple">
                <h4>🔄 Quantum Gates = Rotations</h4>
                <p>Every single-qubit gate is a rotation on the Bloch sphere. X rotates π around X-axis; Z around
                  Z-axis; H
                  swaps X↔Z.</p>
              </div>
              <div class="qt-concept-card orange">
                <h4>💨 Decoherence = Shrinking</h4>
                <p>Noise shrinks the Bloch vector toward the origin. Length < 1 means mixed state. Length=0 is fully
                    mixed.</p>
              </div>

            </div>
          </div>

          <!-- Formula Reference -->
          <div class="qt-formula-box">
            <div class="qt-formula-box-title">📐 Formula Reference</div>
            <div class="qt-formula-row">
              <span class="qt-formula-tag">State</span>
              <div>
                <div class="qt-formula-math">|ψ⟩ = cos(θ/2)|0⟩ + e^(iφ)sin(θ/2)|1⟩</div>
                <div class="qt-formula-desc">Bloch sphere parameterisation</div>
              </div>
            </div>
            <div class="qt-formula-row">
              <span class="qt-formula-tag">X coord</span>
              <div>
                <div class="qt-formula-math">x = sin(θ)cos(φ)</div>
                <div class="qt-formula-desc">Bloch vector x component</div>
              </div>
            </div>
            <div class="qt-formula-row">
              <span class="qt-formula-tag">Y coord</span>
              <div>
                <div class="qt-formula-math">y = sin(θ)sin(φ)</div>
                <div class="qt-formula-desc">Bloch vector y component</div>
              </div>
            </div>
            <div class="qt-formula-row">
              <span class="qt-formula-tag">Z coord</span>
              <div>
                <div class="qt-formula-math">z = cos(θ)</div>
                <div class="qt-formula-desc">Z-axis projection</div>
              </div>
            </div>
            <div class="qt-formula-row">
              <span class="qt-formula-tag">Pauli-X rot</span>
              <div>
                <div class="qt-formula-math">Rₓ(θ) = e^(-iθX/2)</div>
                <div class="qt-formula-desc">X-axis rotation gate</div>
              </div>
            </div>
            <div class="qt-formula-row">
              <span class="qt-formula-tag">Purity</span>
              <div>
                <div class="qt-formula-math">Tr(ρ²) = 1</div>
                <div class="qt-formula-desc">Pure state: lies on surface</div>
              </div>
            </div>

          </div>

          <!-- Did You Know -->
          <div class="qt-dyk">
            <div class="qt-dyk-icon">💡</div>
            <div>
              <div class="qt-dyk-title">Did You Know?</div>
              <div class="qt-dyk-text">The Bloch sphere is named after Felix Bloch (1946), who used it to describe
                nuclear
                magnetic resonance (NMR) — the same physics behind MRI scans in hospitals!</div>
            </div>
          </div>

          <!-- Quantum Notebook -->
          <div class="qt-notebook">
            <div class="qt-nb-header">
              <div class="qt-nb-dots">
                <div class="qt-nb-dot red"></div>
                <div class="qt-nb-dot yellow"></div>
                <div class="qt-nb-dot green"></div>
              </div>
              <div class="qt-nb-title">📓 bloch_sphere.ipynb</div>
            </div>
            <div class="qt-nb-body">
              <div class="qt-nb-label">Interactive Quantum Notebook</div>
              <p style="font-size:13px;color:#64748b;margin:0 0 10px;">Run JavaScript code to explore quantum concepts.
                Select
                an example or write your own:</p>
              <div class="qt-nb-tabs" id="qtnbTabs_bloch3d">
                <div class="qt-nb-tab active" onclick="qtnbSetTab(this,'bloch3d',0)">Bloch Coords</div>
                <div class="qt-nb-tab" onclick="qtnbSetTab(this,'bloch3d',1)">Gate Effects</div>
                <div class="qt-nb-tab" onclick="qtnbSetTab(this,'bloch3d',2)">Decoherence</div>
              </div>
              <div class="qt-nb-editor">
                <textarea class="qt-nb-code" id="qtnbCode_bloch3d" spellcheck="false"></textarea>
              </div>
              <div class="qt-nb-actions">
                <button class="qt-nb-run" onclick="qtnbRun('bloch3d')">▶ Run Code</button>
                <button class="qt-nb-clear" onclick="qtnbClear('bloch3d')">✕ Clear</button>
              </div>
              <div class="qt-nb-output" id="qtnbOut_bloch3d">// Output will appear here...</div>
            </div>
          </div>

        </div>

        <script>
          (function () {
            const _examples_bloch3d = [
              `// Convert qubit state to Bloch vector
function blochVector(theta, phi){
  return {
    x: Math.sin(theta)*Math.cos(phi),
    y: Math.sin(theta)*Math.sin(phi),
    z: Math.cos(theta)
  };
}
const states = {' |0⟩':[0,0],'|1⟩':[Math.PI,0],'|+⟩':[Math.PI/2,0],'|−⟩':[Math.PI/2,Math.PI],'|i⟩':[Math.PI/2,Math.PI/2]};
Object.entries(states).forEach(([name,[t,p]])=>{
  const v=blochVector(t,p);
  console.log(\`\${name}: x=\${v.x.toFixed(2)}, y=\${v.y.toFixed(2)}, z=\${v.z.toFixed(2)}\`);
});`,
              `// See how gates move states on Bloch sphere
const gates = {
  'X (π around X)': (t,p)=>[Math.PI-t, Math.PI+p],
  'Z (π around Z)': (t,p)=>[t, p+Math.PI],
  'H (X↔Z swap)':  (t,p)=>[Math.PI/2-t+Math.PI/2, p===0?0:Math.PI]
};
const start = {theta:0, phi:0, name:'|0⟩'}; // north pole
console.log(\`Start: \${start.name} (θ=\${start.theta}, φ=\${start.phi})\`);
Object.entries(gates).forEach(([g,fn])=>{
  const [t,p]=fn(start.theta,start.phi);
  console.log(\`After \${g}: θ=\${t.toFixed(2)}, φ=\${p.toFixed(2)}\`);
});`,
              `// Simulate decoherence shrinking Bloch vector
let len=1.0;
console.log('Bloch vector length over time:');
for(let t=0;t<=10;t+=2){
  const T2=5; // dephasing time in arbitrary units
  len=Math.exp(-t/T2);
  const bar='█'.repeat(Math.round(len*20));
  console.log(\`t=\${t}: \${bar} \${(len*100).toFixed(0)}% (\${len<0.5?'mixed!':'coherent'})\`);
}`
            ];
            window.qtnbSetTab = window.qtnbSetTab || function (el, pg, idx) {
              el.closest('[id^="qtnbTabs_"]').querySelectorAll('.qt-nb-tab').forEach(t => t.classList.remove('active'));
              el.classList.add('active');
              document.getElementById('qtnbCode_' + pg).value = window['_nbex_' + pg][idx];
            };
            window['_nbex_bloch3d'] = _examples_bloch3d;
            window.qtnbRun = window.qtnbRun || function (pg) {
              const code = document.getElementById('qtnbCode_' + pg).value;
              const out = document.getElementById('qtnbOut_' + pg);
              const logs = []; const origLog = console.log;
              console.log = (...a) => logs.push(a.map(x => typeof x === 'object' ? JSON.stringify(x, null, 2) : String(x)).join(' '));
              try {
                new Function(code)();
                out.textContent = logs.join('\n') || '(no output)';
                out.className = 'qt-nb-output success';
              } catch (e) {
                out.textContent = '❌ Error: ' + e.message;
                out.className = 'qt-nb-output error';
              } finally { console.log = origLog; }
            };
            window.qtnbClear = window.qtnbClear || function (pg) {
              document.getElementById('qtnbCode_' + pg).value = '';
              const out = document.getElementById('qtnbOut_' + pg);
              out.textContent = '// Output will appear here...';
              out.className = 'qt-nb-output';
            };
            // Load first example by default
            if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('qtnbCode_bloch3d').value = _examples_bloch3d[0];
              });
            } else {
              document.getElementById('qtnbCode_bloch3d').value = _examples_bloch3d[0];
            }
          })();
        </script>

</body>

</html>

</body>

</html>